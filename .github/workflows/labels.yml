name: Passed All Tests

on:
  pull_request:
    types: [ opened, labeled, unlabeled ]
  push:

jobs:
  check-label:
    runs-on: ubuntu-latest
    outputs:
      passed-tests: ${{ steps.check-label.outputs.passed-tests }}
    steps:
      - name: Check if label exists
        id: check-label
        run: echo "::set-output name=passed-tests::$(if [[ $(jq -r '.pull_request.labels | map(.name) | contains(["passed-all-tests"])' <<< $GITHUB_EVENT_PATH) == "true" ]]; then echo true; else echo false; fi)"

  fail-if-needs-testing:
    runs-on: ubuntu-latest
    needs: check-label
    steps:
      - name: Fail if PR needs testing
        if: ${{ needs.check-label.outputs.passed-tests == 'false' }}
        run: |
          echo "This PR is currently a draft."
          exit 1